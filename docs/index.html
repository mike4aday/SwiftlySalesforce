<!DOCTYPE html>
<html lang="en">
  <head>
    <title>SwiftlySalesforce  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a title="SwiftlySalesforce  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">SwiftlySalesforce Docs</a> (30% documented)</p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">SwiftlySalesforce Reference</a>
        <img id="carat" src="img/carat.png" />
        SwiftlySalesforce  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/Salesforce.html">Salesforce</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Salesforce/Configuration.html">– Configuration</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Salesforce/User.html">– User</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Salesforce/Options.html">– Options</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Salesforce/Error.html">– Error</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Salesforce/FormFactor.html">– FormFactor</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Salesforce/LayoutType.html">– LayoutType</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Salesforce/Mode.html">– Mode</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/DateFormatter.html">DateFormatter</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Dictionary.html">Dictionary</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/JSONDecoder.html">JSONDecoder</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/JSONEncoder.html">JSONEncoder</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Promise.html">Promise</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/URL.html">URL</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/URLRequest.html">URLRequest</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Functions.html">Functions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Functions.html#/s:17SwiftlySalesforce5first10PromiseKit0D0Cy1TQzGxyKc7execute_tAC8ThenableRzlF">first(execute:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:17SwiftlySalesforce5first10PromiseKit9GuaranteeCyxGAFyc7execute_tlF">first(execute:)</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/URLRequestConvertible.html">URLRequestConvertible</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/Address.html">Address</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Address/GeocodeAccuracy.html">– GeocodeAccuracy</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Authorization.html">Authorization</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/FieldDescription.html">FieldDescription</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Identity.html">Identity</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Limit.html">Limit</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ObjectDescription.html">ObjectDescription</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs.html#/s:17SwiftlySalesforce12OrganizationV">Organization</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/PicklistItem.html">PicklistItem</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/QueryResult.html">QueryResult</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/SObject.html">SObject</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/SearchResult.html">SearchResult</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Typealiases.html">Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:17SwiftlySalesforce12DataResponsea">DataResponse</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:17SwiftlySalesforce7Promisea">Promise</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:17SwiftlySalesforce9Validatora">Validator</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <p><img src="http://mike4aday.github.io/SwiftlySalesforce/images/SwiftlySalesforceLogo.png" width="76%"/></p>

<p><img src="https://img.shields.io/badge/%20in-swift%204-orange.svg"/>&nbsp;<img src="https://img.shields.io/cocoapods/v/SwiftlySalesforce.svg?style=flat"/>&nbsp;<img src="https://img.shields.io/badge/Carthage-compatible-4BC51D.svg?style=flat"/>&nbsp;<img src="https://img.shields.io/cocoapods/l/SwiftlySalesforce.svg?style=flat"/>&nbsp;<img src="https://img.shields.io/cocoapods/p/SwiftlySalesforce.svg?style=flat"/></p>

<p>Build iOS apps fast on the <a href="http://www.salesforce.com/platform/overview/">Salesforce Platform</a> with Swiftly Salesforce:</p>

<ul>
<li>Written entirely in <a href="https://developer.apple.com/swift/">Swift</a>.</li>
<li>Uses <a href="https://en.wikipedia.org/wiki/Futures_and_promises">promises</a> to simplify complex, asynchronous <a href="https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/">Salesforce API</a> interactions.</li>
<li>Manages the Salesforce <a href="https://developer.salesforce.com/page/Digging_Deeper_into_OAuth_2.0_on_Force.com">OAuth2</a> process (the <q>OAuth dance</q>) automatically and transparently.</li>
<li>Simpler and lighter alternative to the Salesforce <a href="https://github.com/forcedotcom/SalesforceMobileSDK-iOS">Mobile SDK for iOS</a>.</li>
<li>Easy to install and update.</li>
</ul>
<h2 id='quick-start' class='heading'>Quick Start</h2>

<p>You can be up and running in a few minutes by following these steps:</p>

<ol>
<li><a href="https://developer.salesforce.com/signup">Get a free Salesforce Developer Edition</a></li>
<li>Create a Salesforce <a href="https://help.salesforce.com/apex/HTViewHelpDoc?id=connected_app_overview.htm">Connected App</a> in your new Developer Edition</li>
<li>Add Swiftly Salesforce to your Xcode project

<ul>
<li><a href="http://www.cocoapods.org">CocoaPods</a>: add <code>pod &#39;SwiftlySalesforce&#39;</code> to your <a href="https://guides.cocoapods.org/syntax/podfile.html">Podfile</a></li>
<li><a href="https://github.com/Carthage/Carthage">Carthage</a>: add <code>github &quot;mike4aday/SwiftlySalesforce&quot;</code> to your <a href="https://github.com/Carthage/Carthage/blob/master/Documentation/Artifacts.md#cartfile">Cartfile</a></li>
</ul></li>
<li>Configure your app delegate (<a href="#example-configure-your-app-delegate">example</a>)</li>
</ol>
<h2 id='minimum-requirements' class='heading'>Minimum Requirements</h2>

<ul>
<li>iOS 11.3</li>
<li>Swift 4</li>
<li>Xcode 9</li>
</ul>
<h2 id='a-href-http-mike4aday-github-io-swiftlysalesforce-docs-documentation-a' class='heading'><a href="http://mike4aday.github.io/SwiftlySalesforce/docs">Documentation</a></h2>

<p>Documentation is <a href="http://mike4aday.github.io/SwiftlySalesforce/docs">here</a>. See especially the public methods of the <code><a href="Classes/Salesforce.html">Salesforce</a></code> class - those are likely all you&rsquo;ll need to call from your code.</p>
<h2 id='examples' class='heading'>Examples</h2>

<p>Below are some examples to illustrate how to use Swiftly Salesforce, and how you can chain complex asynchronous calls. You can also find a complete example app <a href="Example/SwiftlySalesforce">here</a>; it retrieves the logged-in user’s task records from Salesforce, and lets the user update the status of a task.</p>

<p>Swiftly Salesforce will automatically manage the entire Salesforce <a href="https://developer.salesforce.com/page/Digging_Deeper_into_OAuth_2.0_on_Force.com">OAuth2</a> process (the <q>OAuth dance</q>). If Swiftly Salesforce has a valid access token, it will include that token in the header of every API request. If the token has expired, and Salesforce rejects the request, then Swiftly Salesforce will attempt to refresh the access token, without bothering the user to re-enter the username and password. If Swiftly Salesforce doesn&rsquo;t have a valid access token, or is unable to refresh it, then Swiftly Salesforce will direct the user to the Salesforce-hosted login form.</p>

<p>Behind the scenes, Swiftly Salesforce leverages <a href="https://github.com/mxcl/PromiseKit">PromiseKit</a>, a very widely-adopted framework for elegant handling of asynchronous operations.</p>
<h3 id='example-configure-your-app-delegate' class='heading'>Example: Configure Your App Delegate</h3>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">UIKit</span>
<span class="kd">import</span> <span class="kt">SwiftlySalesforce</span>

<span class="c1">// Global Salesforce variable - in your real-world app</span>
<span class="c1">// you could 'inject' it into view controllers instead</span>
<span class="k">var</span> <span class="nv">salesforce</span><span class="p">:</span> <span class="kt">Salesforce</span><span class="o">!</span>

<span class="kd">@UIApplicationMain</span>
<span class="kd">class</span> <span class="kt">AppDelegate</span><span class="p">:</span> <span class="kt">UIResponder</span><span class="p">,</span> <span class="kt">UIApplicationDelegate</span> <span class="p">{</span><span class="c1">//, UNUserNotificationCenterDelegate, LoginDelegate {</span>

    <span class="k">let</span> <span class="nv">consumerKey</span> <span class="o">=</span> <span class="s">"YOUR CONNECTED APP'S CONSUMER KEY HERE"</span>
    <span class="k">let</span> <span class="nv">callbackURL</span> <span class="o">=</span> <span class="s">"YOUR CONNECTED APP'S CALLBACK URL HERE"</span>

    <span class="k">var</span> <span class="nv">window</span><span class="p">:</span> <span class="kt">UIWindow</span><span class="p">?</span>

    <span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="n">didFinishLaunchingWithOptions</span> <span class="nv">launchOptions</span><span class="p">:</span> <span class="p">[</span><span class="kt">UIApplicationLaunchOptionsKey</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]?)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="n">salesforce</span> <span class="o">=</span> <span class="k">try!</span> <span class="kt">Salesforce</span><span class="p">(</span><span class="nv">consumerKey</span><span class="p">:</span> <span class="n">consumerKey</span><span class="p">,</span> <span class="nv">callbackURL</span><span class="p">:</span> <span class="n">callbackURL</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>In the example above, we created a <code><a href="Classes/Salesforce.html">Salesforce</a></code> instance with the Connected App&rsquo;s consumer key and callback URL. <code>salesforce</code> is an implicitly-unwrapped, optional, global variable, but you could also inject a <code><a href="Classes/Salesforce.html">Salesforce</a></code> instance into your root view controller, for example, instead of using a global variable.</p>
<h3 id='example-retrieve-salesforce-records' class='heading'>Example: Retrieve Salesforce Records</h3>

<p>The following will retrieve all the fields for an account record:</p>
<pre class="highlight swift"><code><span class="n">salesforce</span><span class="o">.</span><span class="nf">retrieve</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="s">"Account"</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="s">"0013000001FjCcF"</span><span class="p">)</span>
</code></pre>

<p>To specify which fields should be retrieved:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">"AccountNumber"</span><span class="p">,</span> <span class="s">"BillingCity"</span><span class="p">,</span> <span class="s">"MyCustomField__c"</span><span class="p">]</span>
<span class="n">salesforce</span><span class="o">.</span><span class="nf">retrieve</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="s">"Account"</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="s">"0013000001FjCcF"</span><span class="p">,</span> <span class="nv">fields</span><span class="p">:</span> <span class="n">fields</span><span class="p">)</span>
</code></pre>

<p>Note that <code>retrieve</code> is an asynchronous function, whose return value is a <q>promise</q> that will be fulfilled at some point in the future:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">promise</span><span class="p">:</span> <span class="kt">Promise</span><span class="o">&lt;</span><span class="kt">SObject</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">salesforce</span><span class="o">.</span><span class="nf">retrieve</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="s">"Account"</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="s">"0013000001FjCcF"</span><span class="p">)</span>
</code></pre>

<p>And you can add a closure that will be called later, when the promise is fulfilled:</p>
<pre class="highlight swift"><code><span class="n">salesforce</span><span class="o">.</span><span class="nf">retrieve</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="s">"Account"</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="s">"0013000001FjCcF"</span><span class="p">)</span><span class="o">.</span><span class="n">done</span> <span class="p">{</span> <span class="p">(</span><span class="nv">queryResult</span><span class="p">:</span> <span class="kt">QueryResult</span><span class="o">&lt;</span><span class="kt">SObject</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">()</span> <span class="k">in</span>
    <span class="k">for</span> <span class="nv">record</span><span class="p">:</span> <span class="kt">SObject</span> <span class="k">in</span> <span class="n">queryResult</span><span class="o">.</span><span class="n">records</span> <span class="p">{</span>
        <span class="c1">// Do something more interesting with each record</span>
        <span class="nf">debugPrint</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="p">(</span><span class="nv">error</span><span class="p">:</span> <span class="kt">Error</span><span class="p">)</span> <span class="k">in</span>
    <span class="c1">// Do something with the error</span>
<span class="p">}</span>
</code></pre>

<p>You can retrieve multiple records in parallel, and wait for them all before proceeding:</p>
<pre class="highlight swift"><code><span class="n">first</span> <span class="p">{</span>
    <span class="c1">// (Enclosing this in a ‘first’ block is optional; it keeps things neat.)</span>
    <span class="k">let</span> <span class="nv">ids</span> <span class="o">=</span> <span class="p">[</span><span class="s">"001i0000020i19F"</span><span class="p">,</span> <span class="s">"001i0000034i18A"</span><span class="p">,</span> <span class="s">"001i0000020i22B"</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">salesforce</span><span class="o">.</span><span class="nf">retrieve</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="s">"Account"</span><span class="p">,</span> <span class="nv">ids</span><span class="p">:</span> <span class="n">ids</span><span class="p">)</span>
<span class="p">}</span><span class="o">.</span><span class="n">done</span> <span class="p">{</span> <span class="p">(</span><span class="nv">records</span><span class="p">:</span> <span class="p">[</span><span class="kt">Record</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="p">()</span> <span class="k">in</span>
    <span class="k">for</span> <span class="n">record</span> <span class="k">in</span> <span class="n">records</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="nf">string</span><span class="p">(</span><span class="nv">forField</span><span class="p">:</span> <span class="s">"Name"</span><span class="p">),</span> <span class="k">let</span> <span class="nv">modifiedDate</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="nf">date</span><span class="p">(</span><span class="nv">forField</span><span class="p">:</span> <span class="s">"LastModifiedDate"</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">debugPrint</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="nf">debugPrint</span><span class="p">(</span><span class="n">modifiedDate</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
    <span class="c1">// Handle error...</span>
<span class="p">}</span>
</code></pre>
<h3 id='example-custom-model-objects-new' class='heading'>Example: Custom Model Objects (NEW!)</h3>

<p>Instead of using <code><a href="Structs/SObject.html">SObject</a></code>, you could define your own model objects. Swiftly Salesforce will automatically decode the Salesforce response into your model objects, as long as they implement Swift&rsquo;s <a href="https://developer.apple.com/documentation/swift/decodable"><code>Decodable</code></a> protocol:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">MyAccountModel</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>

    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">createdDate</span><span class="p">:</span> <span class="kt">Date</span>
    <span class="k">var</span> <span class="nv">billingAddress</span><span class="p">:</span> <span class="kt">Address</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">website</span><span class="p">:</span> <span class="kt">URL</span><span class="p">?</span>

    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">id</span> <span class="o">=</span> <span class="s">"Id"</span>
        <span class="k">case</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"Name"</span>
        <span class="k">case</span> <span class="n">createdDate</span> <span class="o">=</span> <span class="s">"CreatedDate"</span>
        <span class="k">case</span> <span class="n">billingAddress</span> <span class="o">=</span> <span class="s">"BillingAddress"</span>
        <span class="k">case</span> <span class="n">website</span> <span class="o">=</span> <span class="s">"Website"</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//...</span>
<span class="n">first</span> <span class="p">{</span>
    <span class="c1">// (Enclosing this in a ‘first’ block is optional; it keeps things neat.)</span>
    <span class="k">let</span> <span class="nv">ids</span> <span class="o">=</span> <span class="p">[</span><span class="s">"001i0000020i19F"</span><span class="p">,</span> <span class="s">"001i0000034i18A"</span><span class="p">,</span> <span class="s">"001i0000020i22B"</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">salesforce</span><span class="o">.</span><span class="nf">retrieve</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="s">"Account"</span><span class="p">,</span> <span class="nv">ids</span><span class="p">:</span> <span class="n">ids</span><span class="p">)</span>
<span class="p">}</span><span class="o">.</span><span class="n">done</span> <span class="p">{</span> <span class="p">(</span><span class="nv">records</span><span class="p">:</span> <span class="p">[</span><span class="kt">MyAccountModel</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="p">()</span> <span class="k">in</span>
    <span class="k">for</span> <span class="n">record</span> <span class="k">in</span> <span class="n">records</span> <span class="p">{</span>
        <span class="c1">// Do something more interesting with record data</span>
        <span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">id</span>
        <span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">name</span>
        <span class="k">let</span> <span class="nv">createdDate</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">createdDate</span>
        <span class="k">let</span> <span class="nv">billingAddress</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">billingAddress</span>
        <span class="k">let</span> <span class="nv">website</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">website</span>
    <span class="p">}</span>
<span class="p">}</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
    <span class="c1">// Handle error...</span>
<span class="p">}</span>
</code></pre>
<h3 id='example-update-a-salesforce-record' class='heading'>Example: Update a Salesforce Record</h3>
<pre class="highlight swift"><code><span class="n">salesforce</span><span class="o">.</span><span class="nf">update</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="s">"Task"</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="s">"00T1500001h3V5NEAU"</span><span class="p">,</span> <span class="nv">fields</span><span class="p">:</span> <span class="p">[</span><span class="s">"Status"</span><span class="p">:</span> <span class="s">"Completed"</span><span class="p">])</span><span class="o">.</span><span class="n">done</span> <span class="p">{</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">()</span> <span class="k">in</span>
    <span class="c1">// Update the local model</span>
<span class="p">}</span><span class="o">.</span><span class="n">finally</span> <span class="p">{</span>
    <span class="c1">// Update the UI</span>
<span class="p">}</span>
</code></pre>

<p>The <code>always</code> closure will be called regardless of success or failure elsewhere in the promise chain.</p>

<p>You could also use the <code>Record</code> type to update a record in Salesforce. For example:</p>
<pre class="highlight plaintext"><code>// `account` is a Record we retrieved earlier...
account.setValue("My New Corp.", forField: "Name")
account.setValue(URL(string: "https://www.mynewcorp.com")!, forField: "Website")
account.setValue("123 Main St.", forField: "BillingStreet")
account.setValue(nil, forField: "Sic")
salesforce.update(record: account).done {
    print("Account updated...")
}.catch {
    error in
    // Handle error
}
</code></pre>
<h3 id='example-query-salesforce' class='heading'>Example: Query Salesforce</h3>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">soql</span> <span class="o">=</span> <span class="s">"SELECT Id,Name FROM Account WHERE BillingPostalCode = '10024'"</span>
<span class="n">salesforce</span><span class="o">.</span><span class="nf">query</span><span class="p">(</span><span class="nv">soql</span><span class="p">:</span> <span class="n">soql</span><span class="p">)</span><span class="o">.</span><span class="n">done</span> <span class="p">{</span> <span class="p">(</span><span class="nv">queryResult</span><span class="p">:</span> <span class="kt">QueryResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">()</span> <span class="k">in</span>
    <span class="k">for</span> <span class="n">record</span> <span class="k">in</span> <span class="n">queryResult</span><span class="o">.</span><span class="n">records</span> <span class="p">{</span>
        <span class="c1">// Do something more interesting with each record</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="nf">string</span><span class="p">(</span><span class="nv">forField</span><span class="p">:</span> <span class="s">"Name"</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Account name: </span><span class="se">\(</span><span class="n">name</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
    <span class="c1">// Handle the error</span>
<span class="p">}</span>
</code></pre>

<p>You could also execute multiple queries at once and wait for them all to complete before proceeding:</p>
<pre class="highlight swift"><code><span class="n">first</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">queries</span> <span class="o">=</span> <span class="p">[</span><span class="s">"SELECT Name FROM Account"</span><span class="p">,</span> <span class="s">"SELECT Id FROM Contact"</span><span class="p">,</span> <span class="s">"Select Owner.Name FROM Lead"</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">salesforce</span><span class="o">.</span><span class="nf">query</span><span class="p">(</span><span class="nv">soql</span><span class="p">:</span> <span class="n">queries</span><span class="p">)</span>
<span class="p">}</span><span class="o">.</span><span class="n">done</span> <span class="p">{</span> <span class="p">(</span><span class="nv">queryResults</span><span class="p">:</span> <span class="p">[</span><span class="kt">QueryResult</span><span class="o">&lt;</span><span class="kt">Record</span><span class="o">&gt;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="p">()</span> <span class="k">in</span>
    <span class="c1">// Results are in the same order as the queries</span>
<span class="p">}</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
    <span class="c1">// Handle the error</span>
<span class="p">}</span>
</code></pre>
<h3 id='example-decode-query-results-as-custom-model-objects-new' class='heading'>Example: Decode Query Results as Custom Model Objects (NEW!)</h3>

<p>You can easily perform complex queries, traversing object relationships, and have all the results decoded automatically into your custom model objects that implement the <a href="https://developer.apple.com/documentation/swift/decodable"><code>Decodable</code></a> protocol:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Account</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>

    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">lastModifiedDate</span><span class="p">:</span> <span class="kt">Date</span>

    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">id</span> <span class="o">=</span> <span class="s">"Id"</span>
        <span class="k">case</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"Name"</span>
        <span class="k">case</span> <span class="n">lastModifiedDate</span> <span class="o">=</span> <span class="s">"LastModifiedDate"</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Contact</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>

    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">firstName</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">lastName</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">createdDate</span><span class="p">:</span> <span class="kt">Date</span>
    <span class="k">var</span> <span class="nv">account</span><span class="p">:</span> <span class="kt">Account</span><span class="p">?</span>

    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">id</span> <span class="o">=</span> <span class="s">"Id"</span>
        <span class="k">case</span> <span class="n">firstName</span> <span class="o">=</span> <span class="s">"FirstName"</span>
        <span class="k">case</span> <span class="n">lastName</span> <span class="o">=</span> <span class="s">"LastName"</span>
        <span class="k">case</span> <span class="n">createdDate</span> <span class="o">=</span> <span class="s">"CreatedDate"</span>
        <span class="k">case</span> <span class="n">account</span> <span class="o">=</span> <span class="s">"Account"</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">getContactsWithAccounts</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">soql</span> <span class="o">=</span> <span class="s">"SELECT Id, FirstName, LastName, CreatedDate, Account.Id, Account.Name, Account.LastModifiedDate FROM Contact"</span>
    <span class="n">salesforce</span><span class="o">.</span><span class="nf">query</span><span class="p">(</span><span class="nv">soql</span><span class="p">:</span> <span class="n">soql</span><span class="p">)</span><span class="o">.</span><span class="n">done</span> <span class="p">{</span> <span class="p">(</span><span class="nv">queryResult</span><span class="p">:</span> <span class="kt">QueryResult</span><span class="o">&lt;</span><span class="kt">Contact</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">()</span> <span class="k">in</span>
        <span class="k">for</span> <span class="n">contact</span> <span class="k">in</span> <span class="n">queryResult</span><span class="o">.</span><span class="n">records</span> <span class="p">{</span>
            <span class="c1">// Do something more interesting with each Contact record</span>
            <span class="nf">debugPrint</span><span class="p">(</span><span class="n">contact</span><span class="o">.</span><span class="n">lastName</span><span class="p">)</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">account</span> <span class="o">=</span> <span class="n">contact</span><span class="o">.</span><span class="n">account</span> <span class="p">{</span>
                <span class="c1">// Do something more interesting with each Account record</span>
                <span class="nf">debugPrint</span><span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
        <span class="c1">// Handle error</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='example-chaining-asynchronous-requests' class='heading'>Example: Chaining Asynchronous Requests</h3>

<p>Let&rsquo;s say we want to retrieve a random zip/postal code from a <a href="https://developer.salesforce.com/page/Creating_REST_APIs_using_Apex_REST">custom Apex REST</a> resource, and then use that zip code in a query:</p>
<pre class="highlight swift"><code><span class="c1">// Chained asynch requests</span>
<span class="n">first</span> <span class="p">{</span>
    <span class="c1">// Make GET request of custom Apex REST resource that returns a zip code as a string</span>
    <span class="k">return</span> <span class="n">salesforce</span><span class="o">.</span><span class="nf">apex</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="s">"/MyApexResourceThatEmitsRandomZip"</span><span class="p">)</span>
<span class="p">}</span><span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="p">(</span><span class="nv">result</span><span class="p">:</span> <span class="kt">Data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Promise</span><span class="o">&lt;</span><span class="kt">QueryResult</span><span class="o">&lt;</span><span class="kt">Record</span><span class="o">&gt;&gt;</span> <span class="k">in</span>
    <span class="c1">// Query accounts in that zip code</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">zip</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">result</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">NSError</span><span class="p">(</span><span class="nv">domain</span><span class="p">:</span> <span class="kt">NSURLErrorDomain</span><span class="p">,</span> <span class="nv">code</span><span class="p">:</span> <span class="kt">NSURLErrorUnknown</span><span class="p">,</span> <span class="nv">userInfo</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">let</span> <span class="nv">soql</span> <span class="o">=</span> <span class="s">"SELECT Id,Name FROM Account WHERE BillingPostalCode = '</span><span class="se">\(</span><span class="n">zip</span><span class="se">)</span><span class="s">'"</span>
    <span class="k">return</span> <span class="n">salesforce</span><span class="o">.</span><span class="nf">query</span><span class="p">(</span><span class="nv">soql</span><span class="p">:</span> <span class="n">soql</span><span class="p">)</span>
<span class="p">}</span><span class="o">.</span><span class="n">done</span> <span class="p">{</span> <span class="n">queryResult</span> <span class="o">-&gt;</span> <span class="p">()</span> <span class="k">in</span>
    <span class="k">for</span> <span class="n">record</span> <span class="k">in</span> <span class="n">queryResult</span><span class="o">.</span><span class="n">records</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="nf">string</span><span class="p">(</span><span class="nv">forField</span><span class="p">:</span> <span class="s">"Name"</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Account name = </span><span class="se">\(</span><span class="n">name</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
    <span class="c1">// Handle error</span>
<span class="p">}</span>
</code></pre>

<p>You could repeat this chaining multiple times, feeding the result of one asynchronous operation as the input to the next. Or you could spawn multiple, simultaneous operations and easily specify logic to be executed when all operations complete, or when just the first completes, or when any one operation fails, etc. PromiseKit is an amazingly-powerful framework for handling multiple asynchronous operations that would otherwise be very difficult to coordinate. See <a href="http://promisekit.org">PromiseKit documentation</a> for more examples.</p>
<h3 id='example-retrieve-a-user-39-s-photo' class='heading'>Example: Retrieve a User&rsquo;s Photo</h3>
<pre class="highlight swift"><code><span class="c1">// "first" block is an optional way to make chained calls easier to read...</span>
<span class="n">first</span> <span class="p">{</span>
    <span class="n">salesforce</span><span class="o">.</span><span class="nf">identity</span><span class="p">()</span>
<span class="p">}</span><span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="p">(</span><span class="n">identity</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Promise</span><span class="o">&lt;</span><span class="kt">UIImage</span><span class="o">&gt;</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">photoURL</span> <span class="o">=</span> <span class="n">identity</span><span class="o">.</span><span class="n">photoURL</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">salesforce</span><span class="o">.</span><span class="nf">fetchImage</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">photoURL</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Return the default image instead</span>
        <span class="k">return</span> <span class="kt">Promise</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">defaultImage</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span><span class="o">.</span><span class="n">done</span> <span class="p">{</span> <span class="n">image</span> <span class="k">in</span>
    <span class="k">self</span><span class="o">.</span><span class="n">photoView</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span>
<span class="p">}</span><span class="o">.</span><span class="n">finally</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="n">refreshControl</span><span class="p">?</span><span class="o">.</span><span class="nf">endRefreshing</span><span class="p">()</span>
<span class="p">}</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">()</span> <span class="k">in</span>
    <span class="c1">// Handle any errors</span>
<span class="p">}</span>
</code></pre>
<h3 id='example-retrieve-a-contact-39-s-photo' class='heading'>Example: Retrieve a Contact&rsquo;s Photo</h3>
<pre class="highlight swift"><code><span class="n">first</span> <span class="p">{</span>
    <span class="n">salesforce</span><span class="o">.</span><span class="nf">retrieve</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="s">"Contact"</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="s">"003f40000027GugAAE"</span><span class="p">)</span>
<span class="p">}</span><span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="p">(</span><span class="nv">record</span><span class="p">:</span> <span class="kt">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Promise</span><span class="o">&lt;</span><span class="kt">UIImage</span><span class="o">&gt;</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">photoPath</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="nf">string</span><span class="p">(</span><span class="nv">forField</span><span class="p">:</span> <span class="s">"PhotoUrl"</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Fetch image</span>
        <span class="k">return</span> <span class="n">salesforce</span><span class="o">.</span><span class="nf">fetchImage</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="n">photoPath</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Return a pre-defined default image</span>
        <span class="k">return</span> <span class="kt">Promise</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">defaultImage</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span><span class="o">.</span><span class="n">done</span> <span class="p">{</span> <span class="p">(</span><span class="nv">image</span><span class="p">:</span> <span class="kt">UIImage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">()</span> <span class="k">in</span>
    <span class="c1">// Do something interesting with the image, e.g. display in a view:</span>
    <span class="c1">// self.photoView.image = image</span>
<span class="p">}</span><span class="o">.</span><span class="n">finally</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="n">refreshControl</span><span class="p">?</span><span class="o">.</span><span class="nf">endRefreshing</span><span class="p">()</span>
<span class="p">}</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">()</span> <span class="k">in</span>
    <span class="c1">// Handle any errors</span>
<span class="p">}</span>
</code></pre>
<h3 id='example-retrieve-an-account-39-s-billing-address' class='heading'>Example: Retrieve an Account&rsquo;s Billing Address</h3>

<p>Addresses for standard objects, e.g. Account and Contact, are stored in a <a href="https://developer.salesforce.com/docs/atlas.en-us.api.meta/api/compound_fields_address.htm">&lsquo;compound&rsquo; Address field</a>, and, if you enable the <a href="https://help.salesforce.com/articleView?id=data_dot_com_clean_admin_clean_rules.htm&language=en_US&type=0">geocode data integration rules</a> in your org, Salesforce will automatically geocode those addresses, giving you latitude and longitude values you could use for map markers. </p>
<pre class="highlight swift"><code><span class="n">first</span> <span class="p">{</span>
    <span class="n">salesforce</span><span class="o">.</span><span class="nf">retrieve</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="s">"Account"</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="s">"001f40000036J5mAAE"</span><span class="p">)</span>
<span class="p">}</span><span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="p">(</span><span class="nv">record</span><span class="p">:</span> <span class="kt">Record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">()</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">address</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="nf">address</span><span class="p">(</span><span class="nv">forField</span><span class="p">:</span> <span class="s">"BillingAddress"</span><span class="p">),</span> <span class="k">let</span> <span class="nv">lon</span> <span class="o">=</span> <span class="n">address</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="k">let</span> <span class="nv">lat</span> <span class="o">=</span> <span class="n">address</span><span class="o">.</span><span class="n">latitude</span> <span class="p">{</span>
    <span class="c1">// You could put a marker on a map...</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"LAT/LON: </span><span class="se">\(</span><span class="n">lat</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">lon</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">()</span> <span class="k">in</span>
    <span class="c1">// Handle any errors</span>
<span class="p">}</span>
</code></pre>

<p>Or use your own custom <code>Decodable</code> model class, instead of the default <code>Record</code>:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">MyAccountModel</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span>

    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">billingAddress</span><span class="p">:</span> <span class="kt">Address</span><span class="p">?</span>

    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">id</span> <span class="o">=</span> <span class="s">"Id"</span>
        <span class="k">case</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"Name"</span>
        <span class="k">case</span> <span class="n">billingAddress</span> <span class="o">=</span> <span class="s">"BillingAddress"</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// ...</span>
<span class="n">first</span> <span class="p">{</span>
    <span class="n">salesforce</span><span class="o">.</span><span class="nf">retrieve</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="s">"Account"</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="s">"001f40000036J5mAAE"</span><span class="p">)</span>
<span class="p">}</span><span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="p">(</span><span class="nv">record</span><span class="p">:</span> <span class="kt">MyAccountModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">()</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">address</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">billingAddress</span><span class="p">,</span> <span class="k">let</span> <span class="nv">lon</span> <span class="o">=</span> <span class="n">address</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="k">let</span> <span class="nv">lat</span> <span class="o">=</span> <span class="n">address</span><span class="o">.</span><span class="n">latitude</span> <span class="p">{</span>
        <span class="c1">// You could put a marker on a map...</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"LAT/LON: </span><span class="se">\(</span><span class="n">lat</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">lon</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">()</span> <span class="k">in</span>
    <span class="c1">// Handle any errors</span>
<span class="p">}</span>
</code></pre>
<h3 id='example-handling-errors' class='heading'>Example: Handling Errors</h3>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">loadUserInfo</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">salesforce</span><span class="o">.</span><span class="nf">identity</span><span class="p">()</span><span class="o">.</span><span class="n">compactMap</span> <span class="p">{</span> <span class="p">(</span><span class="n">identity</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">URL</span><span class="p">?</span> <span class="k">in</span>
        <span class="k">self</span><span class="o">.</span><span class="n">nameLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">identity</span><span class="o">.</span><span class="n">displayName</span>
        <span class="k">return</span> <span class="n">identity</span><span class="o">.</span><span class="n">photoURL</span>
    <span class="p">}</span><span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Promise</span><span class="o">&lt;</span><span class="kt">UIImage</span><span class="o">&gt;</span> <span class="k">in</span>
        <span class="n">salesforce</span><span class="o">.</span><span class="nf">fetchImage</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
    <span class="p">}</span><span class="o">.</span><span class="n">done</span> <span class="p">{</span> <span class="n">image</span> <span class="o">-&gt;</span> <span class="p">()</span> <span class="k">in</span>
        <span class="k">self</span><span class="o">.</span><span class="n">photoView</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span>
    <span class="p">}</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span>
        <span class="nf">debugPrint</span><span class="p">(</span><span class="s">"Unable to load user photo! (</span><span class="se">\(</span><span class="nv">$0</span><span class="o">.</span><span class="n">localizedDescription</span><span class="se">)</span><span class="s">)"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>You could also recover from an error, and continue with the chain, using a <code>recover</code> closure. The following snippet is from PromiseKit&rsquo;s <a href="http://promisekit.org/recovering-from-errors">documentation</a>:</p>
<pre class="highlight swift"><code><span class="kt">CLLocationManager</span><span class="o">.</span><span class="nf">promise</span><span class="p">()</span><span class="o">.</span><span class="n">recover</span> <span class="p">{</span> <span class="n">err</span> <span class="k">in</span>
    <span class="k">guard</span> <span class="o">!</span><span class="n">err</span><span class="o">.</span><span class="n">fatal</span> <span class="k">else</span> <span class="p">{</span> <span class="k">throw</span> <span class="n">err</span> <span class="p">}</span>
    <span class="k">return</span> <span class="kt">CLLocationChicago</span>
<span class="p">}</span><span class="o">.</span><span class="n">done</span> <span class="p">{</span> <span class="n">location</span> <span class="k">in</span>
    <span class="c1">// the user’s location, or Chicago if an error occurred</span>
<span class="p">}</span><span class="o">.</span><span class="n">finally</span> <span class="p">{</span> <span class="n">err</span> <span class="k">in</span>
    <span class="c1">// the error was fatal</span>
<span class="p">}</span>
</code></pre>
<h3 id='example-retrieve-object-metadata' class='heading'>Example: Retrieve Object Metadata</h3>

<p>If, for example, you want to determine whether the user has permission to update or delete a record so you can disable editing in your UI, or if you want to retrieve all the options in a picklist, rather than hardcoding them in your mobile app, then call <code>salesforce.describe(type:)</code> to retrieve an object&rsquo;s <a href="https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/dome_sobject_describe.htm">metadata</a>:</p>
<pre class="highlight swift"><code><span class="n">first</span> <span class="p">{</span>
    <span class="n">salesforce</span><span class="o">.</span><span class="nf">describe</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="s">"Account"</span><span class="p">)</span>
<span class="p">}</span><span class="o">.</span><span class="n">done</span> <span class="p">{</span> <span class="p">(</span><span class="n">accountMetadata</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">()</span> <span class="k">in</span>
    <span class="k">self</span><span class="o">.</span><span class="n">saveButton</span><span class="o">.</span><span class="n">isEnabled</span> <span class="o">=</span> <span class="n">accountMetadata</span><span class="o">.</span><span class="n">isUpdateable</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">fields</span> <span class="o">=</span> <span class="n">accountMetadata</span><span class="o">.</span><span class="n">fields</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">fieldDict</span> <span class="o">=</span> <span class="kt">Dictionary</span><span class="p">(</span><span class="nv">items</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span> <span class="nv">key</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">name</span> <span class="p">})</span>
        <span class="k">let</span> <span class="nv">industryOptions</span> <span class="o">=</span> <span class="n">fieldDict</span><span class="p">[</span><span class="s">"Industry"</span><span class="p">]?</span><span class="o">.</span><span class="n">picklistValues</span>
        <span class="c1">// Populate a drop-down menu with the picklist values...</span>
    <span class="p">}</span>
<span class="p">}</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
    <span class="nf">debugPrint</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>You can retrieve metadata for multiple objects in parallel, and wait for all before proceeding:</p>
<pre class="highlight swift"><code><span class="n">first</span> <span class="p">{</span>
    <span class="n">salesforce</span><span class="o">.</span><span class="nf">describe</span><span class="p">(</span><span class="nv">types</span><span class="p">:</span> <span class="p">[</span><span class="s">"Account"</span><span class="p">,</span> <span class="s">"Contact"</span><span class="p">,</span> <span class="s">"Task"</span><span class="p">,</span> <span class="s">"CustomObject__c"</span><span class="p">])</span>
<span class="p">}</span><span class="o">.</span><span class="n">then</span> <span class="p">{</span> <span class="n">results</span> <span class="o">-&gt;</span> <span class="p">()</span> <span class="k">in</span>
    <span class="c1">// results is an array of ObjectMetadatas, in the same order as requested</span>
<span class="p">}</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
    <span class="c1">// Handle the error</span>
<span class="p">}</span>
</code></pre>
<h3 id='example-log-out' class='heading'>Example: Log Out</h3>

<p>If you want to log out the current Salesforce user, and then clear any locally-cached data, you could call the following. Swiftly Salesforce will revoke and remove any stored credentials.</p>
<pre class="highlight swift"><code><span class="kd">@IBAction</span> <span class="kd">func</span> <span class="nf">logoutButtonPressed</span><span class="p">(</span><span class="nv">sender</span><span class="p">:</span> <span class="kt">AnyObject</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">salesforce</span><span class="o">.</span><span class="nf">revoke</span><span class="p">()</span><span class="o">.</span><span class="n">done</span> <span class="p">{</span>
        <span class="nf">debugPrint</span><span class="p">(</span><span class="s">"Access token revoked."</span><span class="p">)</span>
    <span class="p">}</span><span class="o">.</span><span class="n">ensure</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="nf">removeAll</span><span class="p">()</span>
        <span class="k">self</span><span class="o">.</span><span class="n">tableView</span><span class="o">.</span><span class="nf">reloadData</span><span class="p">()</span>
    <span class="p">}</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span>
        <span class="nf">debugPrint</span><span class="p">(</span><span class="s">"Unable to revoke user access token: </span><span class="se">\(</span><span class="nv">$0</span><span class="o">.</span><span class="n">localizedDescription</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='example-add-swiftly-salesforce-to-your-cocoapods-a-href-https-guides-cocoapods-org-syntax-podfile-html-podfile-a' class='heading'>Example: Add Swiftly Salesforce to Your CocoaPods <a href="https://guides.cocoapods.org/syntax/podfile.html">Podfile</a></h3>
<pre class="highlight plaintext"><code>target 'MyApp' do
  use_frameworks!
  pod 'SwiftlySalesforce'
  # Another pod here
end
</code></pre>
<h2 id='dependent-framework' class='heading'>Dependent Framework</h2>

<p>Swiftly Salesforce depends on <a href="http://promisekit.org">PromiseKit</a>: <q>Not just a promises implementation, it is also a collection of helper functions that make the typical asynchronous patterns we use as iOS developers delightful too.</q></p>
<h2 id='resources' class='heading'>Resources</h2>

<p>If you&rsquo;re new to the Salesforce Platform or the Salesforce REST API, you might find the following resources useful:</p>

<ul>
<li><a href="https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/">Salesforce REST API Developer&rsquo;s Guide</a></li>
<li><a href="http://www.salesforce.com/platform">Salesforce Platform</a></li>
<li><a href="https://developer.salesforce.com">Salesforce Developers</a>: official Salesforce developers&rsquo; site; training, documentation, SDKs, etc.</li>
<li><a href="https://partners.salesforce.com">Salesforce Partner Community</a>: <q>Innovate, grow, connect</q> with Salesforce ISVs. Join the <a href="http://sfdc.co/sfdc-ios">Salesforce + iOS Mobile</a> Chatter group</li>
<li><a href="https://github.com/forcedotcom/SalesforceMobileSDK-iOS">Salesforce Mobile SDK for iOS</a>: Salesforce-supported SDK for developing mobile apps. Written in Objective-C. Available for <a href="https://github.com/forcedotcom/SalesforceMobileSDK-Android">Android</a>, too</li>
<li><a href="https://help.salesforce.com/HTViewSolution?id=000192840&language=en_US">When to Use the Salesforce1 Platform vs. Creating Custom Apps</a></li>
</ul>
<h2 id='contact' class='heading'>Contact</h2>

<p>Questions, suggestions, bug reports and code contributions welcome:</p>

<ul>
<li>Open a <a href="https://github.com/mike4aday/SwiftlySalesforce/issues">GitHub issue</a></li>
<li>Twitter <a href="https://twitter.com/mike4aday">@mike4aday</a></li>
<li>Join the Salesforce <a href="https://p.force.com">Partner Community</a> and post to the &lsquo;<a href="http://sfdc.co/sfdc-ios">Salesforce + iOS Mobile</a>&rsquo; Chatter group</li>
</ul>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2018 <a class="link" href="https://github.com/mike4aday/SwiftlySalesforce" target="_blank" rel="external">Michael Epstein</a>. All rights reserved. (Last updated: 2018-07-13)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.3</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
